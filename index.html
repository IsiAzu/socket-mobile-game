
<html>
	<head>
	
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">

////////////////////////////////////////////////////////////////////////////////
///////////////////////////     SOCKET SECTION   ///////////////////////////////
////////////////////////////////////////////////////////////////////////////////
			var clients=[];
			////  SOCKETS ON  ////
			var socket = io.connect('http://104.131.40.84:8080/');
			socket.on('connect', function() {

				////  SHOW MY CONNECTION  ////
				var sessionid = socket.io.engine.id
				console.log("User Connected: " + sessionid);
        		userList.innerHTML = sessionid;
            
			});

			////  GET OUR UPDATED CLIENT LIST  ////
			socket.on('clientList', function(data){
				clients = data;
				var others = document.getElementById('others');
				others.innerHTML = clients;
				console.log(clients);
			});

			////  GET OTHER USERS ORIENTATION VALUES  ////
			socket.on('positionChangeServer', function(values) {
            		 var clientid = values[0];
            		 var clientAlpha = values[1].a;
            		 var clientBeta = values[1].b;
            		 var clientGamma = values[1].g;
            		 console.log(clientid + " " + clientGamma);
            		
            	});

			
			////  GET MY ORIENTATION VALUES  ////
			function onOrientationChange(e) {
				var alpha = e.alpha,
            	beta = e.beta,
            	gamma = e.gamma;
            	////  *in landscape* Beta will control left/right, Gamma will control up/down  ////
            	values = {a: alpha, b:beta, g:gamma};

            	////  SEND MY VALUES OUT  ////
            	var elem = document.getElementById('map');
            	map.innerHTML = "Alpha: " + Math.floor(alpha) + "  /  Beta: " + Math.floor(beta) + "  /  Gamma: " + Math.floor(gamma);
            	socket.emit('positionChange', values)

			}

////////////////////////////////////////////////////////////////////////////////
///////////////////////     CANVAS DRAWING SECTION   ///////////////////////////
////////////////////////////////////////////////////////////////////////////////

			var context;
			var canvas;
			var w, h;
			var block_x;
			var block_y;
			var block_h = 10;
			var block_w = 10;

			function init(){
			    canvas = document.getElementById("canvas");
			    canvas.width = window.innerWidth - 16;
			    canvas.height = window.innerHeight - 16;
			    context = canvas.getContext('2d');
			    w = canvas.width;
			    h = canvas.height;
			    block_x = w / 2 - 15;
			    block_y = h /2 - 15;
			    setInterval('draw()', 30);
			}

			function clearCanvas() {
			    context.clearRect(0,0,w,h);
			}

			////  DRAW ON YOUR SCREEN  ////
			function draw() {
				////  ASSUMING LANDSCAPE, HOME BUTTON ON LEFT  ////
				////  Tilt left, go left  ////
			    if (values.b<0){
			    	block_x +=3;
			    }
			    ////  Tilt right, go right  ////
			    else if (values.b>0) {
			        block_x -= 3;
			    }
			    ////  Tilt away from you, go up  ////
			    if (values.g<25) {
			        block_y -= 3;
			    }
			    ////  Tilt towards you, go down  ////
			    else if (values.g>25) {
			        block_y += 3;
			    }
			    if (block_x <= 0) {
			        block_x = 0;
			    }
			    if ((block_x + block_w) >= w) {
			        block_x = w - block_w;
			    }
			    if (block_y <= 0) {
			        block_y = 0;
			    }
			    if ((block_y + block_h) >= h) {
			        block_y = h - block_h;
			    }
			    
			    context.beginPath();
			    context.arc(block_x, block_y, block_w/3, 0, 2 * Math.PI, false);
			    context.fillStyle="#FFF";
			    context.fill();
			}

			window.onresize = resize;

			function resize() {
			    console.log("resize event detected!");
			    canvas.width = window.innerWidth - 16;
			    canvas.height = window.innerHeight - 16;
			    w = canvas.width;
			    h = canvas.height;
			}
			////  END OF CANVAS DRAWING  ////

			
			window.addEventListener('deviceorientation', onOrientationChange, false);

		 </script>



		   <style>
		        canvas {
		            display:block;
		            margin: auto;
		        }
   			 </style>
	</head>

	<body onload="init();" style="background: lightgrey">
		me:  <div id="userList"></div>
		<div id="map"></div>
		others:  <div id = "others"></div>
		<canvas id="canvas" style="background: black"></canvas>8
	</body>
</html>
